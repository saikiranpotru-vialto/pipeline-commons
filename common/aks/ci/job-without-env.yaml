parameters:
  - name: acrname
    type: string
  - name: agentPool
    type: string
  - name: repo
    type: string
  - name: dockerBuildContext
    type: string
  - name: dockerfile
    type: string
  - name: condition
    default: succeeded()

jobs:
  - job: App_Build_Push_ACR
    displayName: "Build & Push ${{ parameters.acrname }}"
    pool: ${{ parameters.agentPool }}
    steps:
      - download: none
      - checkout: self
      - task: Docker@2
        displayName: 'Build and Push to ACR: ${{ parameters.acrname }}'
        inputs:
          containerRegistry: ${{ parameters.acrname }}
          repository: ${{ parameters.repo }}
          Dockerfile: ${{ parameters.dockerfile }}
          buildContext: ${{ parameters.dockerBuildContext }}
          tags: |
            $(Build.BuildId)
            latest
        enabled: true